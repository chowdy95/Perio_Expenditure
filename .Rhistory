"2021 Expenditure" =
paste0(total_pc_2021_mean, " (",
round(total_2021_low,1), "-", round(total_2021_high,1), ")"),
"2021 Preventive Expenditure (95% UI)" =
paste0(prev_pc_2021_mean, " (",
round(prev_2021_low,1), "-", round(prev_2021_high,1), ")"),
"2021 Treatment Expenditure (95% UI)" =
paste0(treat_pc_2021_mean, " (",
round(treat_2021_low,1), "-", round(treat_2021_high,1), ")"),
"2021 Rehabilitation Expenditure (95% UI)" =
paste0(rehab_pc_2021_mean, " (",
round(rehab_2021_low,1), "-", round(rehab_2021_high,1), ")"),
"2050 Base Expenditure" =
paste0(total_pc_2050_base_mean, " (",
round(total_2050_base_low,1), "-", round(total_2050_base_high,1), ")"),
"Total % change 2021–2050 base scenario (95% CI)" =
paste0(round(pct_base_mean,1), " (",
round(pct_base_low,1), " to ",
round(pct_base_high,1), ")"),
"2050 Base Preventive Expenditure (95% UI)" =
paste0(prev_pc_2050_base_mean, " (",
round(prev_2050_base_low,1), "-", round(prev_2050_base_high,1), ")"),
"2050 Base Treatment Expenditure (95% UI)" =
paste0(treat_pc_2050_base_mean, " (",
round(treat_2050_base_low,1), "-", round(treat_2050_base_high,1), ")"),
"2050 Base Rehabilitation Expenditure (95% UI)" =
paste0(rehab_pc_2050_base_mean, " (",
round(rehab_2050_base_low,1), "-", round(rehab_2050_base_high,1), ")"),
"2050 WHO Expenditure" =
paste0(total_pc_2050_who_mean, " (",
round(total_2050_who_low,1), "-", round(total_2050_who_high,1), ")"),
"Total % change 2021–2050 WHO target (95% CI)" =
paste0(round(pct_who_mean,1), " (",
round(pct_who_low,1), " to ",
round(pct_who_high,1), ")"),
"2050 WHO Preventive Expenditure (95% UI)" =
paste0(prev_pc_2050_who_mean, " (",
round(prev_2050_who_low,1), "-", round(prev_2050_who_high,1), ")"),
"2050 WHO Treatment Expenditure (95% UI)" =
paste0(treat_pc_2050_who_mean, " (",
round(treat_2050_who_low,1), "-", round(treat_2050_who_high,1), ")"),
"2050 WHO Rehabilitation Expenditure (95% UI)" =
paste0(rehab_pc_2050_who_mean, " (",
round(rehab_2050_who_low,1), "-", round(rehab_2050_who_high,1), ")")
) %>%
select(
location_name,
"2021 Expenditure",
"2021 Preventive Expenditure (95% UI)",
"2021 Treatment Expenditure (95% UI)",
"2021 Rehabilitation Expenditure (95% UI)",
"2050 Base Expenditure",
"Total % change 2021–2050 base scenario (95% CI)",
"2050 Base Preventive Expenditure (95% UI)",
"2050 Base Treatment Expenditure (95% UI)",
"2050 Base Rehabilitation Expenditure (95% UI)",
"2050 WHO Expenditure",
"Total % change 2021–2050 WHO target (95% CI)",
"2050 WHO Preventive Expenditure (95% UI)",
"2050 WHO Treatment Expenditure (95% UI)",
"2050 WHO Rehabilitation Expenditure (95% UI)"
)
View(superregion_percap)
library(tidyverse)
library(readr)
# ------------------------------------------------------------------------------
# 1. Load datasets
# ------------------------------------------------------------------------------
perio_expenditure_wide <- read_csv("outputs_forecast/expenditure_summary_forecast_wide.csv") %>%
rename(location_name = LocationHeader) %>%
select(location_name, ends_with("2021") & contains ("selected"),
ends_with("2050") & contains ("selected"),
Region, Superregion, iso3c, selected_model)
pop_2050 <- read_csv("data/combined_country_input_2050.csv") %>%
select(Country, iso3c, Pop_2050 = Pop)
pop_2021 <- read_csv("data/combined_country_input.csv") %>%
select(Country, Pop_2021 = Pop)
# ------------------------------------------------------------------------------
# 2. Merge populations
# ------------------------------------------------------------------------------
perio_with_pop <- perio_expenditure_wide %>%
select(-iso3c) %>%   # drop old iso3c to avoid .x/.y
left_join(pop_2050, by = c("location_name" = "Country")) %>%
left_join(pop_2021, by = c("location_name" = "Country"))
# ------------------------------------------------------------------------------
# 2b. Minimal patch to fix Global NA
# ------------------------------------------------------------------------------
# Sum up population for Global (only from countries)
global_pop <- perio_with_pop %>%
filter(!is.na(iso3c)) %>%
summarise(
Pop_2021 = sum(Pop_2021, na.rm = TRUE),
Pop_2050 = sum(Pop_2050, na.rm = TRUE)
)
# Fill in Pop_2021 and Pop_2050 for Global row
perio_with_pop <- perio_with_pop %>%
mutate(
Pop_2021 = if_else(location_name == "Global", global_pop$Pop_2021, Pop_2021),
Pop_2050 = if_else(location_name == "Global", global_pop$Pop_2050, Pop_2050)
)
# --- Superregion population ---
superregion_pop <- perio_with_pop %>%
filter(!is.na(iso3c)) %>%   # countries only
group_by(Superregion) %>%
summarise(
Pop_2021_sr = sum(Pop_2021, na.rm = TRUE),
Pop_2050_sr = sum(Pop_2050, na.rm = TRUE),
.groups = "drop"
)
perio_with_pop <- perio_with_pop %>%
left_join(superregion_pop, by = "Superregion") %>%
mutate(
Pop_2021 = if_else(is.na(iso3c) & is.na(Region) & !is.na(Superregion),
Pop_2021_sr, Pop_2021),
Pop_2050 = if_else(is.na(iso3c) & is.na(Region) & !is.na(Superregion),
Pop_2050_sr, Pop_2050)
) %>%
select(-Pop_2021_sr, -Pop_2050_sr)
# --- Region population ---
region_pop <- perio_with_pop %>%
filter(!is.na(iso3c)) %>%   # countries only
group_by(Region) %>%
summarise(
Pop_2021_r = sum(Pop_2021, na.rm = TRUE),
Pop_2050_r = sum(Pop_2050, na.rm = TRUE),
.groups = "drop"
)
perio_with_pop <- perio_with_pop %>%
left_join(region_pop, by = "Region") %>%
mutate(
Pop_2021 = if_else(is.na(iso3c) & !is.na(Region),
Pop_2021_r, Pop_2021),
Pop_2050 = if_else(is.na(iso3c) & !is.na(Region),
Pop_2050_r, Pop_2050)
) %>%
select(-Pop_2021_r, -Pop_2050_r)
# ------------------------------------------------------------------------------
# 3. Compute per-capita expenditures and 95% CI
# ------------------------------------------------------------------------------
perio_percapita <- perio_with_pop %>%
mutate(
# divide expenditures and SDs by population
Mean_total_percap_2021 = selected_Mean_total_billions_2021 * 1e9 / Pop_2021,
SD_total_percap_2021   = selected_SD_total_billions_2021 * 1e9 / Pop_2021,
Mean_total_percap_2050 = selected_Mean_total_billions_2050 * 1e9 / Pop_2050,
SD_total_percap_2050   = selected_SD_total_billions_2050 * 1e9 / Pop_2050,
Mean_total_percap_WHO = WHO_selected_Mean_total_billions_2050 * 1e9 / Pop_2050,
SD_total_percap_WHO   = WHO_selected_SD_total_billions_2050 * 1e9 / Pop_2050
) %>%
# compute 95% UI
mutate(
lower_2021 = Mean_total_percap_2021 - 1.96 * SD_total_percap_2021,
upper_2021 = Mean_total_percap_2021 + 1.96 * SD_total_percap_2021,
lower_2050 = Mean_total_percap_2050 - 1.96 * SD_total_percap_2050,
upper_2050 = Mean_total_percap_2050 + 1.96 * SD_total_percap_2050,
lower_WHO = Mean_total_percap_WHO - 1.96 * SD_total_percap_WHO,
upper_WHO = Mean_total_percap_WHO + 1.96 * SD_total_percap_WHO
)
# ------------------------------------------------------------------------------
# 4. Add per-capita % changes
# ------------------------------------------------------------------------------
perio_percapita <- perio_percapita %>%
mutate(
# log-ratio method for % change
ratio_base = Mean_total_percap_2050 / Mean_total_percap_2021,
log_ratio_base = log(ratio_base),
se_log_ratio_base = sqrt((SD_total_percap_2050 / Mean_total_percap_2050)^2 +
(SD_total_percap_2021 / Mean_total_percap_2021)^2),
log_ratio_base_lower = log_ratio_base - 1.96 * se_log_ratio_base,
log_ratio_base_upper = log_ratio_base + 1.96 * se_log_ratio_base,
pctchange_base_mean = (exp(log_ratio_base) - 1) * 100,
pctchange_base_lower = (exp(log_ratio_base_lower) - 1) * 100,
pctchange_base_upper = (exp(log_ratio_base_upper) - 1) * 100,
ratio_WHO = Mean_total_percap_WHO / Mean_total_percap_2021,
log_ratio_WHO = log(ratio_WHO),
se_log_ratio_WHO = sqrt((SD_total_percap_WHO / Mean_total_percap_WHO)^2 +
(SD_total_percap_2021 / Mean_total_percap_2021)^2),
log_ratio_WHO_lower = log_ratio_WHO - 1.96 * se_log_ratio_WHO,
log_ratio_WHO_upper = log_ratio_WHO + 1.96 * se_log_ratio_WHO,
pctchange_WHO_mean = (exp(log_ratio_WHO) - 1) * 100,
pctchange_WHO_lower = (exp(log_ratio_WHO_lower) - 1) * 100,
pctchange_WHO_upper = (exp(log_ratio_WHO_upper) - 1) * 100
)
# Identify aggregate rows
aggregate_rows <- perio_with_pop %>%
filter(is.na(iso3c)) %>%     # Global, Region, Superregion
mutate(
Mean_total_percap_2021 = selected_Mean_total_billions_2021 * 1e9 / Pop_2021,
Mean_total_percap_2050 = selected_Mean_total_billions_2050 * 1e9 / Pop_2050,
Mean_total_percap_WHO  = WHO_selected_Mean_total_billions_2050 * 1e9 / Pop_2050,
SD_total_percap_2021 = selected_SD_total_billions_2021 * 1e9 / Pop_2021,
SD_total_percap_2050 = selected_SD_total_billions_2050 * 1e9 / Pop_2050,
SD_total_percap_WHO  = WHO_selected_SD_total_billions_2050 * 1e9 / Pop_2050,
lower_2021 = Mean_total_percap_2021 - 1.96 * SD_total_percap_2021,
upper_2021 = Mean_total_percap_2021 + 1.96 * SD_total_percap_2021,
lower_2050 = Mean_total_percap_2050 - 1.96 * SD_total_percap_2050,
upper_2050 = Mean_total_percap_2050 + 1.96 * SD_total_percap_2050,
lower_WHO = Mean_total_percap_WHO - 1.96 * SD_total_percap_WHO,
upper_WHO = Mean_total_percap_WHO + 1.96 * SD_total_percap_WHO,
# log-ratio % change for aggregates
ratio_base = Mean_total_percap_2050 / Mean_total_percap_2021,
log_ratio_base = log(ratio_base),
se_log_ratio_base = sqrt(
(SD_total_percap_2050 / Mean_total_percap_2050)^2 +
(SD_total_percap_2021 / Mean_total_percap_2021)^2
),
log_ratio_base_lower = log_ratio_base - 1.96 * se_log_ratio_base,
log_ratio_base_upper = log_ratio_base + 1.96 * se_log_ratio_base,
pctchange_base_mean  = (exp(log_ratio_base) - 1) * 100,
pctchange_base_lower = (exp(log_ratio_base_lower) - 1) * 100,
pctchange_base_upper = (exp(log_ratio_base_upper) - 1) * 100,
ratio_WHO = Mean_total_percap_WHO / Mean_total_percap_2021,
log_ratio_WHO = log(ratio_WHO),
se_log_ratio_WHO = sqrt(
(SD_total_percap_WHO / Mean_total_percap_WHO)^2 +
(SD_total_percap_2021 / Mean_total_percap_2021)^2
),
log_ratio_WHO_lower = log_ratio_WHO - 1.96 * se_log_ratio_WHO,
log_ratio_WHO_upper = log_ratio_WHO + 1.96 * se_log_ratio_WHO,
pctchange_WHO_mean  = (exp(log_ratio_WHO) - 1) * 100,
pctchange_WHO_lower = (exp(log_ratio_WHO_lower) - 1) * 100,
pctchange_WHO_upper = (exp(log_ratio_WHO_upper) - 1) * 100
)
# Keep country rows only from per-capita computation
country_rows <- perio_percapita %>%
filter(!is.na(iso3c))
# Bind back together
perio_percapita <- bind_rows(country_rows, aggregate_rows)
# ------------------------------------------------------------------------------
# 5. Format final table and add Dental Utilisation Scenario
# ------------------------------------------------------------------------------
country_wide_percap <- perio_percapita %>%
mutate(
"Dental Utilisation Scenario" = selected_model,
"2021 Per-capita Expenditure (95% UI, US$)" = paste0(
round(Mean_total_percap_2021,2), " (",
round(lower_2021,2), "-", round(upper_2021,2), ")"
),
"2050 Base Per-capita Expenditure (95% UI, US$)" = paste0(
round(Mean_total_percap_2050,2), " (",
round(lower_2050,2), "-", round(upper_2050,2), ")"
),
"2050 WHO Per-capita Expenditure (95% UI, US$)" = paste0(
round(Mean_total_percap_WHO,2), " (",
round(lower_WHO,2), "-", round(upper_WHO,2), ")"
),
"Total % change 2021–2050 base scenario (95% UI)" = paste0(
round(pctchange_base_mean,0), "% (",
round(pctchange_base_lower,0), "–",
round(pctchange_base_upper,0), "%)"
),
"Total % change 2021–2050 WHO target (95% UI)" = paste0(
round(pctchange_WHO_mean,0), "% (",
round(pctchange_WHO_lower,0), "–",
round(pctchange_WHO_upper,0), "%)"
)
) %>%
select(
location_name, Region, Superregion,
"2021 Per-capita Expenditure (95% UI, US$)",
"2050 Base Per-capita Expenditure (95% UI, US$)",
"Total % change 2021–2050 base scenario (95% UI)",
"2050 WHO Per-capita Expenditure (95% UI, US$)",
"Total % change 2021–2050 WHO target (95% UI)",
"Dental Utilisation Scenario"
)
View(country_wide_percap)
#-----------------------------------------------------------------------------------------------------------------
# Global and superregion plots
#-----------------------------------------------------------------------------------------------------------------
# Load files and data prep
library(tidyverse)
library(patchwork)
library(countrycode)
perio_expenditure <- read_csv("outputs_forecast/expenditure_summary_forecast.csv") %>%
rename(location_name = LocationHeader) %>%
mutate(
transition_WHO_selected_Mean_total_billions = if_else(Year < 2027, selected_Mean_total_billions, WHO_selected_Mean_total_billions),
transition_WHO_selected_SD_total_billions = if_else(Year < 2027, selected_SD_total_billions, WHO_selected_SD_total_billions)
)
#-----------------------------------------------------------------------------------------------------------------
# Assess perio expenditure changes for each superregion
superregion_cost_df <- perio_expenditure %>%
filter(Level < 2) %>%
mutate(location_name = fct_reorder(location_name, transition_WHO_selected_Mean_total_billions)) %>%
mutate(location_name = fct_rev(location_name))
plot_superregion_cost <- ggplot(data = superregion_cost_df, aes(
x = Year, y = selected_Mean_total_billions
)) +
geom_line(aes(color = location_name, linetype = "Base, current-usage scenario"), linewidth = 1.2) +
geom_ribbon(
aes(
ymin = selected_Mean_total_billions - selected_SD_total_billions,
ymax = selected_Mean_total_billions + selected_SD_total_billions, fill = location_name
),
alpha = 0.05
) +
geom_line(aes(
x = Year, y = transition_WHO_selected_Mean_total_billions,
color = location_name, linetype = "Expanded coverage scenario"
), linewidth = 1.2) +
geom_ribbon(
aes(
ymin = transition_WHO_selected_Mean_total_billions - transition_WHO_selected_SD_total_billions,
ymax = transition_WHO_selected_Mean_total_billions + transition_WHO_selected_SD_total_billions, fill = location_name
),
alpha = 0.05
) +
theme_minimal() +
theme(plot.margin = margin(t = 30, r = 40, b = 20, l = 40),
legend.position = "bottom",
strip.text = element_text(size=10)) +
labs(
y = "Total Periodontitis Expenditure (billions)"
) +
scale_linetype_manual(
values = c("Base, current-usage scenario" = "solid", "Expanded coverage scenario" = "dotted"),
name = "Periodontitis expenditure from 2021 to 2050"
) +
scale_fill_discrete(guide = "none") +
scale_colour_discrete(guide = "none") +
facet_wrap(~location_name, scales = "free", ncol = 2) +
guides(
linetype = guide_legend(
override.aes = list(size = 1.2),     # thickness (optional)
keywidth = unit(1.3, "cm")             # length of line in legend
)
)+
geom_hline(yintercept = 0, color = "black", linewidth = 0.6) +   # x-axis
geom_vline(xintercept = 2020,
color = "black", linewidth = 0.6)
plot_superregion_cost
ggsave("outputs_forecast/patchwork_global_superregion.png", width = 10, height = 11)
ggsave("outputs_forecast/patchwork_global_superregion.pdf", width = 10, height = 11)
#------------------------------------------------------------------------------------------
# Plotting world map with direct expenditure
#------------------------------------------------------------------------------------------
# Load libraries
library(tidyverse)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(countrycode)
library(patchwork)
# Read your data
perio_expenditure <- read_csv("outputs_forecast/expenditure_summary_forecast_percapita.csv")
# Load world map & crop Antarctica
world <- rnaturalearth::ne_countries(scale = "medium", returnclass = "sf") %>%
filter(admin != "Antarctica")
# Join
map_data <- world %>%
inner_join(perio_expenditure, by = c("iso_a3_eh" = "iso3c"), relationship = "many-to-many")
map_data_2021 <- map_data %>%
filter(Year == 2021)
# Plot
map_base_2021 <- ggplot(map_data_2021) +
geom_sf(aes(fill = selected_Mean_total_billions * 1000)) + # billions → millions
scale_fill_viridis_c(
trans = "log10",
option = "plasma",
begin = 0.15, # skew lighter: higher begin shifts scale lighter
end = 1,
direction = -1, # higher = darker
breaks = scales::trans_breaks("log10", function(x) 10^x),
limits = c(1e-1, 1e5),
labels = scales::comma_format(suffix = "M", scale = 1),
na.value = "grey80",
name = "Periodontal Expenditure (Millions USD)"
) +
labs(
title = "Estimated Periodontal Expenditure by Country (2021)"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
plot.subtitle = element_text(hjust = 0.5),
legend.position = "right"
)
map_base_2021
ggsave("outputs_forecast/world_periodontal_expenditure_map_2021.png",
plot = map_base_2021,
width = 24, height = 10, dpi = 300
)
#-----------------------------------------------------------------------------------------------------------------
# Plotting the global map in 2050 for the base scenario
map_data_2050 <- map_data %>%
filter(Year == 2050)
# Plot
map_base_2050 <- ggplot(map_data_2050) +
geom_sf(aes(fill = selected_Mean_total_billions * 1000)) + # billions → millions
scale_fill_viridis_c(
trans = "log10",
option = "plasma",
begin = 0.15, # skew lighter: higher begin shifts scale lighter
end = 1,
direction = -1, # higher = darker
breaks = scales::trans_breaks("log10", function(x) 10^x),
limits = c(1e-1, 1e5),
labels = scales::comma_format(suffix = "M", scale = 1),
na.value = "grey80",
name = "Periodontal Expenditure (Millions USD)"
) +
labs(
title = "Base Scenario: Estimated Periodontal Expenditure by Country (2050)"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
plot.subtitle = element_text(hjust = 0.5),
legend.position = "right"
)
map_base_2050
#-----------------------------------------------------------------------------------------------------------------
# Plotting the global map in 2050 for the WHO scenario
map_data_2050 <- map_data %>%
filter(Year == 2050)
# Plot
map_base_2050_WHO <- ggplot(map_data_2050) +
geom_sf(aes(fill = transition_WHO_selected_Mean_total_billions * 1000)) + # billions → millions
scale_fill_viridis_c(
trans = "log10",
option = "plasma",
begin = 0.15, # skew lighter: higher begin shifts scale lighter
end = 1,
direction = -1, # higher = darker
breaks = scales::trans_breaks("log10", function(x) 10^x),
limits = c(1e-1, 1e5),
labels = scales::comma_format(suffix = "M", scale = 1),
na.value = "grey80",
name = "Periodontal Expenditure (Millions USD)"
) +
labs(
title = "Expanded Coverage Scenario: Estimated Periodontal Expenditure by Country (2050)"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
plot.subtitle = element_text(hjust = 0.5),
legend.position = "right"
)
map_base_2050_WHO
#-----------------------------------------------------------------------------------------------------------------
# Plotting the gap in dental expenditure between the current dental expenditure and WHO target in 2050
perio_expenditure_wide <- read_csv("outputs_forecast/expenditure_summary_forecast_wide.csv") %>%
rename(location_name = LocationHeader) %>%
mutate(
gap_WHO_mean = WHO_selected_Mean_total_billions_2050 - selected_Mean_total_billions_2021
)
# Load world map & crop Antarctica
world <- rnaturalearth::ne_countries(scale = "medium", returnclass = "sf") %>%
filter(admin != "Antarctica")
# Join
map_data_gap <- world %>%
inner_join(perio_expenditure_wide, by = c("iso_a3_eh" = "iso3c"), relationship = "many-to-many")
# Plot
map_base_gap <- ggplot(map_data_gap) +
geom_sf(aes(fill = gap_WHO_mean * 1000)) + # billions → millions
scale_fill_viridis_c(
trans = "log10",
option = "plasma",
begin = 0.15, # skew lighter: higher begin shifts scale lighter
end = 1,
direction = -1, # higher = darker
breaks = scales::trans_breaks("log10", function(x) 10^x),
limits = c(1e-1, 1e5),
labels = scales::comma_format(suffix = "M", scale = 1),
na.value = "grey80",
name = "Periodontal Expenditure (Millions USD)"
) +
labs(
title = "Gap between 2021 expenditure and 2050 Expanded Coverage Scenario",
subtitle = "Countries with decrease or no change in grey"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
plot.subtitle = element_text(hjust = 0.5),
legend.position = "right"
)
map_base_gap
#-----------------------------------------------------------------------------------------------------------------
# Save with suitable dimensions for world map
plot_patchwork_map <- (map_base_2050 + map_base_2050_WHO + map_base_gap) +
plot_layout(ncol = 1, nrow = 3) +
plot_annotation(tag_levels = "A")
plot_patchwork_map
ggsave("outputs_forecast/world_periodontal_expenditure_map_2021_2050.png",
plot = plot_patchwork_map,
width = 18, height = 20, dpi = 300
)
# #-----------------------------------------------------------------------------------------------------------------
# #-----------------------------------------------------------------------------------------------------------------
# # Assessment of prevalent counts around the world over time
# #-----------------------------------------------------------------------------------------------------------------
# #-----------------------------------------------------------------------------------------------------------------
#
# # Load files and data prep
#
# library(tidyverse)
# library(patchwork)
# library(countrycode)
#
# perio_prevalence_counts <- read_csv("data/GBD_prev_perio_count.csv") %>%
#   select(location_id, location_name, val, upper, lower) %>%
#   rename("mean" = "val") %>%
#   mutate (year_id = 2021)
#
# hier <- read_csv("data/GBD_location_hierarchy.csv", locale = locale(encoding = "Latin1")) %>%
#   select("Location ID", "Location Name", "Level", "Sort Order") %>%
#   rename(location_id = "Location ID", location_name = "Location Name") %>%
#   slice(1:233) # all groupings after this are non-GBD hierarchy groupings
#
