transition_WHO_selected_Mean_total_billions = if_else(Year < 2027, selected_Mean_total_billions, WHO_selected_Mean_total_billions),
transition_WHO_selected_SD_total_billions = if_else(Year < 2027, selected_SD_total_billions, WHO_selected_SD_total_billions)
)
perio_expenditure_countries <- perio_expenditure %>%
filter(Level == 3)
#-----------------------------------------s-os-os-os-os-so-o-os
library(ggplot2)
library(dplyr)
library(forcats)
library(patchwork)
# ------------------------------------------------------------------------------
# 1. Prepare top 10 datasets
# ------------------------------------------------------------------------------
perio_expenditure_countries <- perio_expenditure %>% filter(Level == 3)
# Top 5 by total expenditure
top_10_expenditure <- perio_expenditure_countries %>%
filter(Year == 2050) %>%
arrange(desc(transition_WHO_selected_Mean_total_billions)) %>%
slice(1:5) %>%
select(iso3c)
top_10_expenditure_df <- perio_expenditure %>%
inner_join(top_10_expenditure, by = "iso3c") %>%
mutate(location_name = fct_reorder(location_name, transition_WHO_selected_Mean_total_billions)) %>%
mutate(location_name = fct_rev(location_name))
# Top 5 by per-capita expenditure
top_10_exppc <- perio_expenditure_countries %>%
filter(Year == 2050) %>%
mutate(
WHO_exppc_usd_mean = (transition_WHO_selected_Mean_total_billions * 1e9) / Pop
) %>%
arrange(desc(WHO_exppc_usd_mean)) %>%
slice(1:5) %>%
select(iso3c)
top_10_exppc_df <- perio_expenditure_countries %>%
inner_join(top_10_exppc, by = "iso3c") %>%
mutate(location_name = fct_reorder(location_name, WHO_exppc_usd_mean)) %>%
mutate(location_name = fct_rev(location_name))
# ------------------------------------------------------------------------------
# 1. Prepare top 10 datasets
# ------------------------------------------------------------------------------
perio_expenditure_countries <- perio_expenditure %>% filter(Level == 3)
# Top 5 by total expenditure
top_10_expenditure <- perio_expenditure_countries %>%
filter(Year == 2050) %>%
arrange(desc(transition_WHO_selected_Mean_total_billions)) %>%
slice(1:5) %>%
select(iso3c)
top_10_expenditure_df <- perio_expenditure %>%
inner_join(top_10_expenditure, by = "iso3c") %>%
mutate(location_name = fct_reorder(location_name, transition_WHO_selected_Mean_total_billions)) %>%
mutate(location_name = fct_rev(location_name))
# Top 5 by per-capita expenditure
top_10_exppc <- perio_expenditure_countries %>%
filter(Year == 2050) %>%
mutate(
WHO_exppc_usd_mean = (transition_WHO_selected_Mean_total_billions * 1e9) / Pop
) %>%
arrange(desc(WHO_exppc_usd_mean)) %>%
slice(1:5) %>%
select(iso3c)
top_10_exppc_df <- perio_expenditure_countries %>%
inner_join(top_10_exppc, by = "iso3c") %>%
mutate(location_name = fct_reorder(location_name, WHO_exppc_usd_mean)) %>%
mutate(location_name = fct_rev(location_name))
library(tidyverse)
library(patchwork)
library(forcats)
# ------------------------------------------------------------------------------
# Filter country-level data (Level 3)
# ------------------------------------------------------------------------------
perio_expenditure_countries <- perio_expenditure %>%
filter(Level == 3)
# ------------------------------------------------------------------------------
# Compute per-capita expenditure first
# ------------------------------------------------------------------------------
perio_expenditure_countries <- perio_expenditure_countries %>%
mutate(
# Base scenario per capita (USD)
selected_exppc_usd_mean = (selected_Mean_total_billions * 1e9) / Pop,
selected_exppc_usd_sd   = sqrt(
(selected_SD_total_billions * 1e9 / Pop)^2 +
(selected_Mean_total_billions * 1e9 * Pop_sd / Pop^2)^2
),
# Expanded coverage scenario per capita
ExpandedCoverage_exppc_usd_mean = (transition_WHO_selected_Mean_total_billions * 1e9) / Pop,
ExpandedCoverage_exppc_usd_sd   = sqrt(
(transition_WHO_selected_SD_total_billions * 1e9 / Pop)^2 +
(transition_WHO_selected_Mean_total_billions * 1e9 * Pop_sd / Pop^2)^2
)
)
# ------------------------------------------------------------------------------
# Top 5 countries for total expenditure (2050)
# ------------------------------------------------------------------------------
top_10_expenditure <- perio_expenditure_countries %>%
filter(Year == 2050) %>%
arrange(desc(transition_WHO_selected_Mean_total_billions)) %>%
slice(1:5) %>%
select(iso3c)
top_10_expenditure_df <- perio_expenditure_countries %>%
inner_join(top_10_expenditure, by = "iso3c") %>%
mutate(location_name = fct_reorder(location_name, transition_WHO_selected_Mean_total_billions)) %>%
mutate(location_name = fct_rev(location_name))
# Total expenditure plot
plot_top10_exp_cost <- ggplot(top_10_expenditure_df, aes(x = Year, y = selected_Mean_total_billions, group = location_name)) +
geom_line(data = perio_expenditure_countries, aes(x = Year, y = selected_Mean_total_billions, linetype = "Base, current-usage scenario"), alpha = 0.15) +
geom_line(data = top_10_expenditure_df, aes(x = Year, y = selected_Mean_total_billions, color = location_name, linetype = "Base, current-usage scenario")) +
geom_ribbon(
aes(
ymin = selected_Mean_total_billions - selected_SD_total_billions,
ymax = selected_Mean_total_billions + selected_SD_total_billions,
fill = location_name
),
alpha = 0.1
) +
geom_line(aes(
x = Year, y = transition_WHO_selected_Mean_total_billions,
color = location_name, linetype = "Expanded coverage scenario"
)) +
geom_ribbon(
aes(
ymin = transition_WHO_selected_Mean_total_billions - transition_WHO_selected_SD_total_billions,
ymax = transition_WHO_selected_Mean_total_billions + transition_WHO_selected_SD_total_billions,
fill = location_name
),
alpha = 0.05
) +
theme_minimal() +
theme(plot.margin = margin(t = 30, r = 40, b = 20, l = 40)) +
labs(
y = "Total Periodontitis Expenditure (millions USD)",
color = "Country (top 5 for 2050 expenditure)"
) +
scale_linetype_manual(
values = c("Base, current-usage scenario" = "solid", "Expanded coverage scenario" = "dashed"),
name = "Scenario (if base = expanded coverage, only base shown)"
) +
guides(fill = "none", alpha = "none")
# ------------------------------------------------------------------------------
# Top 5 countries for per-capita expenditure (2050)
# ------------------------------------------------------------------------------
top_10_exppc <- perio_expenditure_countries %>%
filter(Year == 2050) %>%
arrange(desc(ExpandedCoverage_exppc_usd_mean)) %>%
slice(1:5) %>%
select(iso3c)
top_10_exppc_df <- perio_expenditure_countries %>%
inner_join(top_10_exppc, by = "iso3c") %>%
mutate(location_name = fct_reorder(location_name, ExpandedCoverage_exppc_usd_mean)) %>%
mutate(location_name = fct_rev(location_name))
# Per-capita expenditure plot
geom_line(data = perio_expenditure_countries, aes(x = Year, y = selected_exppc_usd_mean, linetype = "Base, current-usage scenario"), alpha = 0.15) +
geom_ribbon(
ymin = selected_exppc_usd_mean - selected_exppc_usd_sd,
fill = location_name
alpha = 0.1
# Per-capita expenditure plot
plot_top10_exppc_cost <- ggplot(top_10_exppc_df, aes(x = Year, y = selected_exppc_usd_mean, group = location_name)) +
library(tidyverse)
library(tidyverse)
library(patchwork)
library(forcats)
# ------------------------------------------------------------------------------
# Filter country-level data (Level 3)
# ------------------------------------------------------------------------------
perio_expenditure_countries <- perio_expenditure %>%
filter(Level == 3)
# ------------------------------------------------------------------------------
# Compute per-capita expenditure first
# ------------------------------------------------------------------------------
perio_expenditure_countries <- perio_expenditure_countries %>%
mutate(
# Base scenario per capita (USD)
selected_exppc_usd_mean = (selected_Mean_total_billions * 1e9) / Pop,
selected_exppc_usd_sd   = sqrt(
(selected_SD_total_billions * 1e9 / Pop)^2 +
(selected_Mean_total_billions * 1e9 * Pop_sd / Pop^2)^2
),
# Expanded coverage scenario per capita
ExpandedCoverage_exppc_usd_mean = (transition_WHO_selected_Mean_total_billions * 1e9) / Pop,
ExpandedCoverage_exppc_usd_sd   = sqrt(
(transition_WHO_selected_SD_total_billions * 1e9 / Pop)^2 +
(transition_WHO_selected_Mean_total_billions * 1e9 * Pop_sd / Pop^2)^2
)
)
# ------------------------------------------------------------------------------
# Top 5 countries for total expenditure (2050)
# ------------------------------------------------------------------------------
top_10_expenditure <- perio_expenditure_countries %>%
filter(Year == 2050) %>%
arrange(desc(transition_WHO_selected_Mean_total_billions)) %>%
slice(1:5) %>%
select(iso3c)
top_10_expenditure_df <- perio_expenditure_countries %>%
inner_join(top_10_expenditure, by = "iso3c") %>%
mutate(location_name = fct_reorder(location_name, transition_WHO_selected_Mean_total_billions)) %>%
mutate(location_name = fct_rev(location_name))
# Total expenditure plot
plot_top10_exp_cost <- ggplot(top_10_expenditure_df, aes(x = Year, y = selected_Mean_total_billions, group = location_name)) +
geom_line(data = perio_expenditure_countries, aes(x = Year, y = selected_Mean_total_billions, linetype = "Base, current-usage scenario"), alpha = 0.15) +
geom_line(data = top_10_expenditure_df, aes(x = Year, y = selected_Mean_total_billions, color = location_name, linetype = "Base, current-usage scenario")) +
geom_ribbon(
aes(
ymin = selected_Mean_total_billions - selected_SD_total_billions,
ymax = selected_Mean_total_billions + selected_SD_total_billions,
fill = location_name
),
alpha = 0.1
) +
geom_line(aes(
x = Year, y = transition_WHO_selected_Mean_total_billions,
color = location_name, linetype = "Expanded coverage scenario"
)) +
geom_ribbon(
aes(
ymin = transition_WHO_selected_Mean_total_billions - transition_WHO_selected_SD_total_billions,
ymax = transition_WHO_selected_Mean_total_billions + transition_WHO_selected_SD_total_billions,
fill = location_name
),
alpha = 0.05
) +
theme_minimal() +
theme(plot.margin = margin(t = 30, r = 40, b = 20, l = 40)) +
labs(
y = "Total Periodontitis Expenditure (millions USD)",
color = "Country (top 5 for 2050 expenditure)"
) +
scale_linetype_manual(
values = c("Base, current-usage scenario" = "solid", "Expanded coverage scenario" = "dashed"),
name = "Scenario (if base = expanded coverage, only base shown)"
) +
guides(fill = "none", alpha = "none")
# ------------------------------------------------------------------------------
# Top 5 countries for per-capita expenditure (2050)
# ------------------------------------------------------------------------------
top_10_exppc <- perio_expenditure_countries %>%
filter(Year == 2050) %>%
arrange(desc(ExpandedCoverage_exppc_usd_mean)) %>%
slice(1:5) %>%
select(iso3c)
top_10_exppc_df <- perio_expenditure_countries %>%
inner_join(top_10_exppc, by = "iso3c") %>%
mutate(location_name = fct_reorder(location_name, ExpandedCoverage_exppc_usd_mean)) %>%
mutate(location_name = fct_rev(location_name))
# Per-capita expenditure plot
plot_top10_exppc_cost <- ggplot(top_10_exppc_df, aes(x = Year, y = selected_exppc_usd_mean, group = location_name)) +
geom_line(data = perio_expenditure_countries, aes(x = Year, y = selected_exppc_usd_mean, linetype = "Base, current-usage scenario"), alpha = 0.15) +
geom_line(data = top_10_exppc_df, aes(x = Year, y = selected_exppc_usd_mean, color = location_name, linetype = "Base, current-usage scenario")) +
geom_ribbon(
aes(
ymin = selected_exppc_usd_mean - selected_exppc_usd_sd,
ymax = selected_exppc_usd_mean + selected_exppc_usd_sd,
fill = location_name
),
alpha = 0.1
) +
geom_line(aes(
x = Year, y = ExpandedCoverage_exppc_usd_mean,
color = location_name, linetype = "Expanded coverage scenario"
)) +
geom_ribbon(
aes(
ymin = ExpandedCoverage_exppc_usd_mean - ExpandedCoverage_exppc_usd_sd,
ymax = ExpandedCoverage_exppc_usd_mean + ExpandedCoverage_exppc_usd_sd,
fill = location_name
),
alpha = 0.05
) +
theme_minimal() +
theme(plot.margin = margin(t = 30, r = 40, b = 20, l = 40)) +
labs(
y = "Per-capita Periodontitis Expenditure (2025 USD)",
color = "Country (top 5 for 2050 per-capita expenditure)"
) +
scale_linetype_manual(
values = c("Base, current-usage scenario" = "solid", "Expanded coverage scenario" = "dashed"),
name = "Scenario (if base = expanded coverage, only base shown)"
) +
guides(fill = "none", alpha = "none")
# ------------------------------------------------------------------------------
# Combine plots with aligned legends
# ------------------------------------------------------------------------------
plot_countries_expenditure <- plot_top10_exp_cost + plot_top10_exppc_cost +
plot_annotation(tag_levels = "A") +
plot_layout(ncol = 1, nrow = 2, guides = "collect") # aligns legends
# Save
ggsave("outputs_forecast/patchwork_countries_expenditure.png", plot_countries_expenditure, width = 15, height = 12, dpi = 300)
#------------------------------------------------------------------------------------------
# Plotting world map with direct expenditure
#------------------------------------------------------------------------------------------
# Load libraries
library(tidyverse)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(countrycode)
library(patchwork)
# Read your data
perio_expenditure <- read_csv("outputs_forecast/expenditure_summary_forecast_percapita.csv")
# Load world map & crop Antarctica
world <- rnaturalearth::ne_countries(scale = "medium", returnclass = "sf") %>%
filter(admin != "Antarctica")
# Join
map_data <- world %>%
inner_join(perio_expenditure, by = c("iso_a3_eh" = "iso3c"), relationship = "many-to-many")
map_data_2021 <- map_data %>%
filter(Year == 2021)
# Plot
map_base_2021 <- ggplot(map_data_2021) +
geom_sf(aes(fill = selected_Mean_total_billions * 1000)) + # billions → millions
scale_fill_viridis_c(
trans = "log10",
option = "plasma",
begin = 0.15, # skew lighter: higher begin shifts scale lighter
end = 1,
direction = -1, # higher = darker
breaks = scales::trans_breaks("log10", function(x) 10^x),
limits = c(1e-1, 1e5),
labels = scales::comma_format(suffix = "M", scale = 1),
na.value = "grey80",
name = "Periodontal Expenditure (Millions USD)"
) +
labs(
title = "Estimated Periodontal Expenditure by Country (2021)",
subtitle = "Countries with no data shown in grey"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
plot.subtitle = element_text(hjust = 0.5),
legend.position = "right"
)
map_base_2021
ggsave("outputs_forecast/world_periodontal_expenditure_map_2021.png",
plot = map_base_2021,
width = 24, height = 10, dpi = 300
)
#-----------------------------------------------------------------------------------------------------------------
# Plotting the global map in 2050 for the base scenario
map_data_2050 <- map_data %>%
filter(Year == 2050)
# Plot
map_base_2050 <- ggplot(map_data_2050) +
geom_sf(aes(fill = selected_Mean_total_billions * 1000)) + # billions → millions
scale_fill_viridis_c(
trans = "log10",
option = "plasma",
begin = 0.15, # skew lighter: higher begin shifts scale lighter
end = 1,
direction = -1, # higher = darker
breaks = scales::trans_breaks("log10", function(x) 10^x),
limits = c(1e-1, 1e5),
labels = scales::comma_format(suffix = "M", scale = 1),
na.value = "grey80",
name = "Periodontal Expenditure (Millions USD)"
) +
labs(
title = "Base Scenario: Estimated Periodontal Expenditure by Country (2050)",
subtitle = "Countries with no data shown in grey"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
plot.subtitle = element_text(hjust = 0.5),
legend.position = "right"
)
map_base_2050
#-----------------------------------------------------------------------------------------------------------------
# Plotting the global map in 2050 for the WHO scenario
map_data_2050 <- map_data %>%
filter(Year == 2050)
# Plot
map_base_2050_WHO <- ggplot(map_data_2050) +
geom_sf(aes(fill = transition_WHO_selected_Mean_total_billions * 1000)) + # billions → millions
scale_fill_viridis_c(
trans = "log10",
option = "plasma",
begin = 0.15, # skew lighter: higher begin shifts scale lighter
end = 1,
direction = -1, # higher = darker
breaks = scales::trans_breaks("log10", function(x) 10^x),
limits = c(1e-1, 1e5),
labels = scales::comma_format(suffix = "M", scale = 1),
na.value = "grey80",
name = "Periodontal Expenditure (Millions USD)"
) +
labs(
title = "WHO-Informed Expanded Coveraget Scenario: Estimated Periodontal Expenditure by Country (2050)",
subtitle = "Countries with no data shown in grey"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
plot.subtitle = element_text(hjust = 0.5),
legend.position = "right"
)
map_base_2050_WHO
#-----------------------------------------------------------------------------------------------------------------
# Plotting the gap in dental expenditure between the current dental expenditure and WHO target in 2050
perio_expenditure_wide <- read_csv("outputs_forecast/expenditure_summary_forecast_wide.csv") %>%
rename(location_name = LocationHeader) %>%
mutate(
gap_WHO_mean = WHO_selected_Mean_total_billions_2050 - selected_Mean_total_billions_2021
)
# Load world map & crop Antarctica
world <- rnaturalearth::ne_countries(scale = "medium", returnclass = "sf") %>%
filter(admin != "Antarctica")
# Join
map_data_gap <- world %>%
inner_join(perio_expenditure_wide, by = c("iso_a3_eh" = "iso3c"), relationship = "many-to-many")
# Plot
map_base_gap <- ggplot(map_data_gap) +
geom_sf(aes(fill = gap_WHO_mean * 1000)) + # billions → millions
scale_fill_viridis_c(
trans = "log10",
option = "plasma",
begin = 0.15, # skew lighter: higher begin shifts scale lighter
end = 1,
direction = -1, # higher = darker
breaks = scales::trans_breaks("log10", function(x) 10^x),
limits = c(1e-1, 1e5),
labels = scales::comma_format(suffix = "M", scale = 1),
na.value = "grey80",
name = "Periodontal Expenditure (Millions USD)"
) +
labs(
title = "Gap between 2021 expenditure and 2050 Expanded Coverage Scenario",
subtitle = "Countries with decrease or no change in grey"
) +
theme_minimal() +
theme(
plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
plot.subtitle = element_text(hjust = 0.5),
legend.position = "right"
)
map_base_gap
#-----------------------------------------------------------------------------------------------------------------
# Save with suitable dimensions for world map
plot_patchwork_map <- (map_base_2050 + map_base_2050_WHO + map_base_gap) +
plot_layout(ncol = 1, nrow = 3) +
plot_annotation(tag_levels = "A")
plot_patchwork_map
ggsave("outputs_forecast/world_periodontal_expenditure_map_2021_2025.png",
plot = plot_patchwork_map,
width = 18, height = 20, dpi = 300
)
#-----------------------------------------------------------------------------------------------------------------
# Global and superregion plots
#-----------------------------------------------------------------------------------------------------------------
# Load files and data prep
library(tidyverse)
library(patchwork)
library(countrycode)
perio_expenditure <- read_csv("outputs_forecast/expenditure_summary_forecast.csv") %>%
rename(location_name = LocationHeader) %>%
mutate(
transition_WHO_selected_Mean_total_billions = if_else(Year < 2027, selected_Mean_total_billions, WHO_selected_Mean_total_billions),
transition_WHO_selected_SD_total_billions = if_else(Year < 2027, selected_SD_total_billions, WHO_selected_SD_total_billions)
)
#-----------------------------------------------------------------------------------------------------------------
# Assess perio expenditure changes for each superregion
superregion_cost_df <- perio_expenditure %>%
filter(Level < 2) %>%
mutate(location_name = fct_reorder(location_name, transition_WHO_selected_Mean_total_billions)) %>%
mutate(location_name = fct_rev(location_name))
plot_superregion_cost <- ggplot(data = superregion_cost_df, aes(
x = Year, y = selected_Mean_total_billions
)) +
geom_line(aes(color = location_name, linetype = "Base, current-usage scenario"), linewidth = 1.2) +
geom_ribbon(
aes(
ymin = selected_Mean_total_billions - selected_SD_total_billions,
ymax = selected_Mean_total_billions + selected_SD_total_billions, fill = location_name
),
alpha = 0.05
) +
geom_line(aes(
x = Year, y = transition_WHO_selected_Mean_total_billions,
color = location_name, linetype = "WHO-informed expanded coverage scenario"
), linewidth = 1.2) +
geom_ribbon(
aes(
ymin = transition_WHO_selected_Mean_total_billions - transition_WHO_selected_SD_total_billions,
ymax = transition_WHO_selected_Mean_total_billions + transition_WHO_selected_SD_total_billions, fill = location_name
),
alpha = 0.05
) +
theme_minimal() +
theme(plot.margin = margin(t = 30, r = 40, b = 20, l = 40),
legend.position = "bottom",
strip.text = element_text(size=10)) +
labs(
y = "Total Periodontitis Expenditure (billions)"
) +
scale_linetype_manual(
values = c("Base, current-usage scenario" = "solid", "WHO-informed expanded coverage scenario" = "dotted"),
name = "Periodontitis expenditure from 2021 to 2050"
) +
scale_fill_discrete(guide = "none") +
scale_colour_discrete(guide = "none") +
facet_wrap(~location_name, scales = "free", ncol = 2) +
guides(
linetype = guide_legend(
override.aes = list(size = 1.2),     # thickness (optional)
keywidth = unit(1.3, "cm")             # length of line in legend
)
)+
geom_hline(yintercept = 0, color = "black", linewidth = 0.6) +   # x-axis
geom_vline(xintercept = 2020,
color = "black", linewidth = 0.6)
plot_superregion_cost
ggsave("outputs_forecast/patchwork_global_superregion.png", width = 8, height = 11)
ggsave("outputs_forecast/patchwork_global_superregion.png", width = 10, height = 11)
