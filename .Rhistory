# ------------------------------------------------------------------------------
hier <- read_csv(
"data/GBD_location_hierarchy_wide.csv",
locale = locale(encoding = "Latin1")
) %>%
mutate(iso3c = countrycode(Country, "country.name", "iso3c")) %>%
select(Country, Superregion)
# ------------------------------------------------------------------------------
# 3. Aggregate directly to Superregion
# ------------------------------------------------------------------------------
superregion_results <- df_results %>%
left_join(hier, by = "Country") %>%
filter(!is.na(Superregion)) %>%
group_by(Superregion, n_sims) %>%
summarise(
Mean_total_billions = sum(Mean_total_billions, na.rm = TRUE),
.groups = "drop"
)
# ------------------------------------------------------------------------------
# 4. Plot convergence (colour by Superregion)
# ------------------------------------------------------------------------------
p2 <- ggplot(
superregion_results,
aes(
x = n_sims,
y = Mean_total_billions,
colour = Superregion,
group = Superregion
)
) +
geom_line(linewidth = 1, alpha = 0.8) +
theme_minimal() +
scale_x_continuous(
limits = c(1000, 12000),
breaks = seq(1000, 12000, 1000)
) +
labs(
x = "Number of simulations",
y = "Mean total dental expenditure (US$ billions)",
colour = "Superregion"
)
p2 <- ggplot(
superregion_results,
aes(
x = n_sims,
y = Mean_total_billions,
colour = Superregion,
group = Superregion
)
) +
geom_line(linewidth = 1, alpha = 0.8) +
theme_minimal() +
scale_x_continuous(
limits = c(1000, 12000),
breaks = seq(1000, 12000, 1000)
) +
labs(
x = "Number of simulations",
y = "Mean total dental expenditure (US$ billions)",
colour = "Superregion"
)
p2
superregion_results
superregion_results <- df_results %>%
left_join(hier, by = "Country") %>%
filter(!is.na(Superregion))
superregion_results
superregion_results <- df_results %>%
left_join(hier, by = "Country") %>%
filter(!is.na(Superregion)) %>%
group_by(Superregion, n_sims) %>%
summarise(
MCSE_total_billions = SD_total_billions/sqrt(n_sims),
Mean_total_billions = sum(Mean_total_billions, na.rm = TRUE),
.groups = "drop"
)
p2 <- ggplot(
superregion_results,
aes(
x = n_sims,
y = MCSE_total_billions,
colour = Superregion,
group = Superregion
)
) +
geom_line(linewidth = 1, alpha = 0.8) +
theme_minimal() +
scale_x_continuous(
limits = c(1000, 12000),
breaks = seq(1000, 12000, 1000)
) +
labs(
x = "Number of simulations",
y = "Mean total dental expenditure (US$ billions)",
colour = "Superregion"
)
p2
p2$data
View(p2$data)
superregion_results <- df_results %>%
left_join(hier, by = "Country") %>%
filter(!is.na(Superregion))
View(superregion_results)
superregion_results <- df_results %>%
left_join(hier, by = "Country") %>%
filter(!is.na(Superregion)) %>%
group_by(Superregion, n_sims) %>%
summarise(
MCSE_total_billions = median(SD_total_billions/sqrt(n_sims)),
Mean_total_billions = sum(Mean_total_billions, na.rm = TRUE),
.groups = "drop"
)
p2 <- ggplot(
superregion_results,
aes(
x = n_sims,
y = MCSE_total_billions,
colour = Superregion,
group = Superregion
)
) +
geom_line(linewidth = 1, alpha = 0.8) +
theme_minimal() +
scale_x_continuous(
limits = c(1000, 12000),
breaks = seq(1000, 12000, 1000)
) +
labs(
x = "Number of simulations",
y = "Mean total dental expenditure (US$ billions)",
colour = "Superregion"
)
p2
ggsave(
"convergence_tests/convergence_plot_superregion.jpg",
plot = p2,
width = 9,
height = 9,
dpi = 300
)
p2 <- ggplot(
superregion_results,
aes(
x = n_sims,
y = MCSE_total_billions,
colour = Superregion,
group = Superregion
)
) +
geom_line(linewidth = 1, alpha = 0.8) +
theme_minimal() +
scale_x_continuous(
limits = c(1000, 12000),
breaks = seq(1000, 12000, 1000)
) +
labs(
x = "Number of simulations",
y = "Median Monte Carlo Standard Error",
colour = "Superregion"
) +
theme(legend.position = "bottom")
p2
ggsave(
"convergence_tests/convergence_plot_superregion.jpg",
plot = p2,
width = 9,
height = 9,
dpi = 300
)
ggsave(
"convergence_tests/convergence_plot_superregion.jpg",
plot = p2,
width = 7,
height = 10,
dpi = 300
)
ggsave(
"convergence_tests/convergence_plot_superregion.jpg",
plot = p2,
width = 10,
height = 7,
dpi = 300
)
p2 <- ggplot(
superregion_results,
aes(
x = n_sims,
y = MCSE_total_billions,
colour = Superregion,
group = Superregion
)
) +
geom_line(linewidth = 1, alpha = 0.8) +
theme_minimal() +
scale_x_continuous(
limits = c(1000, 12000),
breaks = seq(1000, 12000, 1000)
) +
labs(
x = "Number of simulations",
y = "Median Monte Carlo Standard Error",
colour = "Superregion"
) +
theme(legend.position = "bottom",
legend.byrow = TRUE)
p2
ggsave(
"convergence_tests/convergence_plot_superregion.jpg",
plot = p2,
width = 10,
height = 7,
dpi = 300
)
p2 <- ggplot(
superregion_results,
aes(
x = n_sims,
y = MCSE_total_billions,
colour = Superregion,
group = Superregion
)
) +
geom_line(linewidth = 1, alpha = 0.8) +
theme_minimal() +
scale_x_continuous(
limits = c(1000, 12000),
breaks = seq(1000, 12000, 1000)
) +
labs(
x = "Number of simulations",
y = "Median Monte Carlo Standard Error",
colour = "Superregion"
) +
theme(legend.justification = "inside")
p2
p2 <- ggplot(
superregion_results,
aes(
x = n_sims,
y = MCSE_total_billions,
colour = Superregion,
group = Superregion
)
) +
geom_line(linewidth = 1, alpha = 0.8) +
theme_minimal() +
scale_x_continuous(
limits = c(1000, 12000),
breaks = seq(1000, 12000, 1000)
) +
labs(
x = "Number of simulations",
y = "Median Monte Carlo Standard Error",
colour = "Superregion"
) +
theme(legend.justification.inside = TRUE)
p2
p2 <- ggplot(
superregion_results,
aes(
x = n_sims,
y = MCSE_total_billions,
colour = Superregion,
group = Superregion
)
) +
geom_line(linewidth = 1, alpha = 0.8) +
theme_minimal() +
scale_x_continuous(
limits = c(1000, 12000),
breaks = seq(1000, 12000, 1000)
) +
labs(
x = "Number of simulations",
y = "Median Monte Carlo Standard Error",
colour = "Superregion"
) +
theme(legend.position.inside = x = 10000, y = 0.2)
p2
p2 <- ggplot(
superregion_results,
aes(
x = n_sims,
y = MCSE_total_billions,
colour = Superregion,
group = Superregion
)
) +
geom_line(linewidth = 1, alpha = 0.8) +
theme_minimal() +
scale_x_continuous(
limits = c(1000, 12000),
breaks = seq(1000, 12000, 1000)
) +
labs(
x = "Number of simulations",
y = "Median Monte Carlo Standard Error",
colour = "Superregion"
) +
theme(legend.position.inside = c(x = 10000, y = 0.2))
p2
p2 <- ggplot(
superregion_results,
aes(
x = n_sims,
y = MCSE_total_billions,
colour = Superregion,
group = Superregion
)
) +
geom_line(linewidth = 1, alpha = 0.8) +
theme_minimal() +
scale_x_continuous(
limits = c(1000, 12000),
breaks = seq(1000, 12000, 1000)
) +
labs(
x = "Number of simulations",
y = "Median Monte Carlo Standard Error",
colour = "Superregion"
) +
theme(legend.position = c(x = 10000, y = 0.2))
p2 <- ggplot(
superregion_results,
aes(
x = n_sims,
y = MCSE_total_billions,
colour = Superregion,
group = Superregion
)
) +
geom_line(linewidth = 1, alpha = 0.8) +
theme_minimal() +
scale_x_continuous(
limits = c(1000, 12000),
breaks = seq(1000, 12000, 1000)
) +
labs(
x = "Number of simulations",
y = "Median Monte Carlo Standard Error",
colour = "Superregion"
) +
theme(legend.position.inside = c(x = 10000, y = 0.2))
p2
p2 <- ggplot(
superregion_results,
aes(
x = n_sims,
y = MCSE_total_billions,
colour = Superregion,
group = Superregion
)
) +
geom_line(linewidth = 1, alpha = 0.8) +
theme_minimal() +
scale_x_continuous(
limits = c(1000, 12000),
breaks = seq(1000, 12000, 1000)
) +
labs(
x = "Number of simulations",
y = "Median Monte Carlo Standard Error",
colour = "Superregion"
) +
theme(legend.position.inside = c(10000, 0.2))
p2
p2 <- ggplot(
superregion_results,
aes(
x = n_sims,
y = MCSE_total_billions,
colour = Superregion,
group = Superregion
)
) +
geom_line(linewidth = 1, alpha = 0.8) +
theme_minimal() +
scale_x_continuous(
limits = c(1000, 12000),
breaks = seq(1000, 12000, 1000)
) +
labs(
x = "Number of simulations",
y = "Median Monte Carlo Standard Error",
colour = "Superregion"
) +
theme(legend.position = "inside",
legend.position.inside = c(10000, 0.2))
p2
p2 <- ggplot(
superregion_results,
aes(
x = n_sims,
y = MCSE_total_billions,
colour = Superregion,
group = Superregion
)
) +
geom_line(linewidth = 1, alpha = 0.8) +
theme_minimal() +
scale_x_continuous(
limits = c(1000, 12000),
breaks = seq(1000, 12000, 1000)
) +
labs(
x = "Number of simulations",
y = "Median Monte Carlo Standard Error",
colour = "Superregion"
) +
theme(legend.position = "inside",
legend.position.inside = c(0.8, 0.2))
p2
p2 <- ggplot(
superregion_results,
aes(
x = n_sims,
y = MCSE_total_billions,
colour = Superregion,
group = Superregion
)
) +
geom_line(linewidth = 1, alpha = 0.8) +
theme_minimal() +
scale_x_continuous(
limits = c(1000, 12000),
breaks = seq(1000, 12000, 1000)
) +
labs(
x = "Number of simulations",
y = "Median Monte Carlo Standard Error",
colour = "Superregion"
) +
theme(legend.position = "inside",
legend.position.inside = c(0.8, 0.9))
p2
p2 <- ggplot(
superregion_results,
aes(
x = n_sims,
y = MCSE_total_billions,
colour = Superregion,
group = Superregion
)
) +
geom_line(linewidth = 1, alpha = 0.8) +
theme_minimal() +
scale_x_continuous(
limits = c(1000, 12000),
breaks = seq(1000, 12000, 1000)
) +
labs(
x = "Number of simulations",
y = "Median Monte Carlo Standard Error",
colour = "Superregion"
) +
theme(legend.position = "inside",
legend.position.inside = c(0.8, 0.8))
p2
p2 <- ggplot(
superregion_results,
aes(
x = n_sims,
y = MCSE_total_billions,
colour = Superregion,
group = Superregion
)
) +
geom_line(linewidth = 1, alpha = 0.8) +
theme_minimal() +
scale_x_continuous(
limits = c(1000, 12000),
breaks = seq(1000, 12000, 1000)
) +
labs(
x = "Number of simulations",
y = "Median Monte Carlo Standard Error",
colour = "Superregion"
) +
theme(legend.position = "inside",
legend.position.inside = c(0.7, 0.8))
p2
p2 <- ggplot(
superregion_results,
aes(
x = n_sims,
y = MCSE_total_billions,
colour = Superregion,
group = Superregion
)
) +
geom_line(linewidth = 1, alpha = 0.8) +
theme_minimal() +
scale_x_continuous(
limits = c(1000, 12000),
breaks = seq(1000, 12000, 1000)
) +
labs(
x = "Number of simulations",
y = "Median Monte Carlo Standard Error",
colour = "Superregion"
) +
theme(legend.position = "inside",
legend.position.inside = c(0.7, 0.8),
panel.grid.minor = element_blank())
p2
ggsave(
"convergence_tests/convergence_plot_superregion.jpg",
plot = p2,
width = 10,
height = 7,
dpi = 300
)
